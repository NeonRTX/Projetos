using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Sistema_De_Combate
{
    class Program
    {
        static void Main(string[] args)
        {
            Personagem jogadorAtual;

            //Instâncias dos Personagens
            Guerreiro guerreiro = new Guerreiro();
            Mago mago = new Mago();

            /*Arqueiro arqueiro1 = new Arqueiro();
            
            Clerigo clerigo1 = new Clerigo();*/

            //Instâncias dos Inimigos
            Blindado blindado = new Blindado();

            Inicio(blindado);
                    
                

            int turnos = 0;
            while (blindado.Vivo == true)
            {
                if (turnos != 0)
                {
                    if (guerreiro.Vida > 0 && mago.Vida <= 0)
                    {
                        blindado.Atacar(guerreiro);
                        guerreiro.VerificarSeMorreu();
                    }                    
                    else if (guerreiro.Vida < mago.Vida && guerreiro.Armadura == 18)
                    {
                        blindado.Atacar(guerreiro);
                        guerreiro.VerificarSeMorreu();
                    }
                    else if (mago.Vida < guerreiro.Vida)
                    {
                        blindado.Atacar(mago);
                        mago.VerificarSeMorreu();
                    }
                }

                turnos++;

                for (int i = 0; i < 2; i++)
                {
                    if (i % 2 == 0 && mago.Vida > 0)
                    {
                        jogadorAtual = mago;
                        mago.VerificarArmadura();
                    }
                    else if (guerreiro.Vida > 0 && mago.Vida <= 0)
                    {
                        jogadorAtual = guerreiro;
                        guerreiro.VerificarEspecial();
                        guerreiro.VerificarArmadura();
                        i++;
                    }
                    else if (guerreiro.Vida > 0)
                    {
                        jogadorAtual = guerreiro;
                        guerreiro.VerificarEspecial();
                        guerreiro.VerificarArmadura();
                    } else
                        jogadorAtual = null;
                    /*if(jogadorAtual is Guerreiro)
                    {
                        jogadorAtual.VerificarEspecial();
                    }

                    jogadorAtual.VerificarArmadura();*/

                    Console.WriteLine($"{turnos}° TURNO\n");
                    Console.WriteLine($"--{blindado.Nome}--");
                    Console.WriteLine($"Vida Atual: {blindado.Vida}");
                    Console.WriteLine($"Armadura Atual: {blindado.Armadura}\n");
                    //Console.WriteLine($"Está vivo? {blindado.Vivo}\n");
                    Console.WriteLine($"--{jogadorAtual.Nome}--");
                    Console.WriteLine($"Vida Atual: {jogadorAtual.Vida}");
                    Console.WriteLine($"Armadura Atual: {jogadorAtual.Armadura}");
                    Console.WriteLine($"Estamina Atual: {jogadorAtual.Estamina}\n");
                    Console.WriteLine("Escolha a ação que deseja tomar...");
                    Console.WriteLine("1 - Atacar");
                    Console.WriteLine("2 - Defender");
                    Console.WriteLine("3 - Usar Especial");

                    string opcao = Console.ReadLine();
                    Console.Clear();

                    switch (opcao)
                    {
                        case "1":
                            jogadorAtual.Atacar(blindado);                            
                            break;
                        case "2":
                            jogadorAtual.Defender();
                            break;
                        case "3":
                            jogadorAtual.UsarEspecial(blindado);
                            break;
                    }

                    

                    blindado.VerificarSeMorreu();
                    if (blindado.Vivo == false)
                    {
                        break;
                    }
                }

            }
            
        }
        public static void Inicio(Blindado blindado)
        {
            //Console.WriteLine("\nVocê foi mandado numa missão para acabar com o covil dos goblins...");
            Console.WriteLine("\nSua PARTY foi mandada numa missão para investigar a MASMORRA SANGRENTA...");
            Console.WriteLine("Um Guerreiro...");
            Console.WriteLine("Um Mago...");
            /* Console.WriteLine("Um Arqueiro...");
             Console.WriteLine("Um Clérigo...\n");*/
            Console.WriteLine("Aperte qualquer tecla para continuar...");
            Console.ReadKey();
            Console.Clear();
            Console.WriteLine("\nAdentrando a masmorra vocês se deparam com seu primeiro inimigo...");
            Console.WriteLine($"Um gramde {blindado.Nome} está a frente de vocês...");
            Console.WriteLine($"Ele é um guarda alto e forte e com uma armadura quase impenetrável...");
            Console.WriteLine("E agora vocês precisa tomar uma decisão...\n");
            Console.WriteLine("Aperte qualquer tecla para continuar...");
            Console.ReadKey();
            Console.Clear();
        }
    }

    abstract class Personagem
    {
        public string Nome;
        public int Vida;
        public int Estamina;
        public int Ataque;
        public int Armadura;
        //public int Iniciativa;
        public bool Vivo;

        //Método para ROLAGEM DE DADOS
        public static Random dadoPersonagem = new Random();

        public abstract void UsarEspecial(Inimigo inimigo);
        /*{
        }*/

        public abstract void Atacar(Inimigo inimigo);

        public virtual void Defender()
        {
            Armadura += 5;
        }

        public void VerificarSeMorreu()
        {
            if (Vida <= 0)
            {
                Vivo = false;
                Console.WriteLine($"O {Nome} morreu...");
                Console.WriteLine("...");
                Console.ReadKey();
            }
        }

    }

    class Guerreiro : Personagem
    {
        int turnosArmadura = 0;
        int turnosEspecial = 0;
        bool Especial = false;

        public Guerreiro()
        {
            Vida = 12;
            Estamina = 3;
            Ataque = 4;
            Armadura = 18;
            Nome = "GUERREIRO";
            Vivo = true;
        }

        public override void Atacar(Inimigo inimigo)
        {
            int acertoPersonagem;
            int dano;
            int danoE;
            int dadoAcerto;

            dadoAcerto = dadoPersonagem.Next(1, 21);
            acertoPersonagem = Ataque + dadoAcerto;
            if (dadoAcerto >= 19 && Especial == false)
            {
                Console.WriteLine("=== JOGADA GUERREIRO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total: {acertoPersonagem}");
                Console.WriteLine("Voce CRITOU o ataque");
                dano = dadoPersonagem.Next(1, 9) * 2;
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano;
                if (inimigo.Vida < 0)
                {
                    inimigo.Vida = 0;
                }
            }
            else if (acertoPersonagem > inimigo.Armadura && Especial == false)
            {
                Console.WriteLine("=== JOGADA GUERREIRO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce acertou o ataque");
                dano = dadoPersonagem.Next(1, 9);
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano;
                if (inimigo.Vida < 0)
                {
                    inimigo.Vida = 0;
                }
            }
            else if (acertoPersonagem < inimigo.Armadura && Especial == false )
            {

                Console.WriteLine("=== JOGADA GUERREIRO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce não acertou");
                Console.WriteLine("========================\n");

            }
            else if (acertoPersonagem < inimigo.Armadura && Especial == true)
            {

                Console.WriteLine("=== JOGADA GUERREIRO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce não acertou");
                Console.WriteLine("========================\n");

            }
            else if (dadoAcerto >= 19 && Especial == true)
            {
                Console.WriteLine("=== JOGADA GUERREIRO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total: {acertoPersonagem}");
                Console.WriteLine("Voce CRITOU o ataque");
                dano = dadoPersonagem.Next(1, 9) * 2;
                danoE = dano / 2;
                Console.WriteLine($"Dano total: {dano} + {danoE}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano + danoE;
                if (inimigo.Vida < 0)
                {
                    inimigo.Vida = 0;
                }
            }
            else if (acertoPersonagem > inimigo.Armadura && Especial == true)
            {
                Console.WriteLine("=== JOGADA GUERREIRO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce acertou o ataque");
                dano = dadoPersonagem.Next(1, 9);
                danoE = dano / 2;
                Console.WriteLine($"Dano total: {dano} + {danoE}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano + danoE;
                if (inimigo.Vida < 0)
                {
                    inimigo.Vida = 0;
                }
            }
        }

        public void VerificarArmadura()
        {
            if (Armadura != 18)
            {
                turnosArmadura++;

                if (turnosArmadura > 3)
                {
                    Armadura = 18;
                    turnosArmadura = 0;
                }
            }
        }

        public override void UsarEspecial(Inimigo inimigo)
        {
            Especial = true;
            Estamina--;
        }

        public void VerificarEspecial()
        {
            if (Especial == true)
                turnosEspecial++;
            if (turnosEspecial > 3)
            {
                Especial = false;
                turnosEspecial = 0;
            }

        }

    }


    class Mago : Personagem
    {

        int turnosArmadura = 0;

        public Mago()
        {
            Vida = 8;
            Estamina = 3;
            Ataque = 4;
            Armadura = 14;
            Nome = "MAGO";
            Vivo = true;

        }

        public override void Atacar(Inimigo inimigo)
        {
            int acertoPersonagem;
            int dano;
            int dadoAcerto;

            dadoAcerto = dadoPersonagem.Next(1, 21);
            acertoPersonagem = Ataque + dadoAcerto;
            if (dadoAcerto >= 19)
            {
                Console.WriteLine("=== JOGADA MAGO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total: {acertoPersonagem}");
                Console.WriteLine("Voce CRITOU o ataque");
                dano = dadoPersonagem.Next(1, 11) * 2;
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano;
            }
            else if (acertoPersonagem > inimigo.Armadura)
            {
                Console.WriteLine("=== JOGADA MAGO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce acertou o ataque");
                dano = dadoPersonagem.Next(1, 11);
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano;
            }
            else if (acertoPersonagem < inimigo.Armadura)
            {

                Console.WriteLine("=== JOGADA MAGO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce não acertou");
                Console.WriteLine("========================\n");

            }
            
        }

        public void VerificarArmadura()
        {
            if (Armadura != 14)
            {
                turnosArmadura++;

                if (turnosArmadura > 3)
                {
                    Armadura = 14;
                    turnosArmadura = 0;
                }
            }
        }

        public override void UsarEspecial(Inimigo inimigo)
        {
            //Especial = true;                       
            Estamina--;

            int acertoPersonagem;
            int dano;
            int dadoAcerto;

            dadoAcerto = dadoPersonagem.Next(1, 21);
            acertoPersonagem = Ataque + dadoAcerto;
            if (dadoAcerto >= 19)
            {
                Console.WriteLine("=== JOGADA MAGO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total: {acertoPersonagem}");
                Console.WriteLine("Voce CRITOU o ataque");
                dano = (dadoPersonagem.Next(1, 9) + dadoPersonagem.Next(1, 9) + dadoPersonagem.Next(1, 9)) * 2;
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano;
            }
            else if (acertoPersonagem > inimigo.Armadura)
            {
                Console.WriteLine("=== JOGADA MAGO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce acertou o ataque");
                dano = dadoPersonagem.Next(1, 9) + dadoPersonagem.Next(1, 9) + dadoPersonagem.Next(1, 9);
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                inimigo.Vida -= dano;
            }
            else if (acertoPersonagem < inimigo.Armadura)
            {

                Console.WriteLine("=== JOGADA MAGO ===");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoPersonagem}");
                Console.WriteLine("Voce não acertou");
                Console.WriteLine("========================\n");

            }


        }
    }

    /*class Arqueiro : Personagem
    {
        public Arqueiro()
        {
            Vida = 12;
            Estamina = 3;
            Ataque = 4;
            Armadura = 16;
        }
    }

    class Clerigo : Personagem
    {
        public Clerigo()
        {
            Vida = 10;
            Estamina = 3;
            Ataque = 4;
            Armadura = 12;
        }
    }
    */

    abstract class Inimigo
    {
        //Método para ROLAGEM DE DADOS  
        public static Random dadoInimigo = new Random();
        public int Vida;
        public int Estamina;
        public int Ataque;
        public int Armadura;
        public bool Vivo;
        public string Nome;
    }

    class Blindado : Inimigo
    {
        public Blindado()
        {
            Vida = 45;
            Estamina = 3;
            Ataque = 4;
            Armadura = 16;
            Vivo = true;
            Nome = "BLINDADO";
        }

        public void Atacar(Personagem personagem)
        {
            int acertoInimigo;
            int dano;
            int dadoAcerto;

            //Console.Clear();

            dadoAcerto = dadoInimigo.Next(1, 21);
            acertoInimigo = Ataque + dadoAcerto;
            if (dadoAcerto >= 19)
            {
                Console.WriteLine($"==== JOGADA {Nome} ====");
                Console.WriteLine($"O {Nome} atacou o {personagem.Nome}");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total: {acertoInimigo}");
                Console.WriteLine($"O {Nome} CRITOU o ataque");
                dano = dadoInimigo.Next(1, 9) * 2;
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                personagem.Vida -= dano;
            }
            else if (acertoInimigo > personagem.Armadura)
            {
                Console.WriteLine($"==== JOGADA {Nome} ====");
                Console.WriteLine($"O {Nome} atacou o {personagem.Nome}");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoInimigo}");
                Console.WriteLine($"O {Nome} acertou o ataque");
                dano = dadoInimigo.Next(1, 9);
                Console.WriteLine($"Dano total: {dano}");
                Console.WriteLine("========================\n");
                personagem.Vida -= dano;
            }
            else if (acertoInimigo < personagem.Armadura)
            {
                Console.WriteLine($"==== JOGADA {Nome} ====");
                Console.WriteLine($"O {Nome} atacou o {personagem.Nome}");
                Console.WriteLine($"Rolagem: {dadoAcerto} + {Ataque}");
                Console.WriteLine($"Total para acertar: {acertoInimigo}");
                Console.WriteLine($"O {Nome} não acertou");
                Console.WriteLine("========================\n");
            }
        }

        public void VerificarSeMorreu()
        {
            if (Vida <= 0)
            {
                Vivo = false;
                Console.WriteLine($"Você matou o {Nome}...");
                Console.WriteLine("Caminho para a masmorra livre...");                
                Console.ReadKey();
            }
        }

    }

    class Harpia : Inimigo
    {
        public Harpia()
        {
            Vida = 60;
            Estamina = 3;
            Ataque = 6;
            Armadura = 13;
        }
    }

}
